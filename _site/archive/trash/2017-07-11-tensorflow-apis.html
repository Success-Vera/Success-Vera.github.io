

<!DOCTYPE html>
<html >

  <head>

    
    

<meta charset="utf-8"/>
<meta name="author" content="Ifeoma Veronica Nwabufo"/>


<meta name="keywords" content="tensorflow"/>


<!-- Enable responsive viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<!-- atom & rss feed -->
<link href="" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed"/>

<!--
<link href="" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed"/>
-->

<!-- Le fav and touch icons -->
<link rel="shortcut icon" href="images/favicon.ico"/>
    
	<!--

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    tex2jax: {
      inlineMath: [ ['$','$'], ['\(', '\)'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true,
    }
  });
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
-->
    <title>TensorFlow APIs - Ifeoma Veronica Nwabufo's Website</title>

    <!-- normalize.css -->
    <link rel="stylesheet" type="text/css" media="all"
          href="/bower_components/normalize-css/normalize.css" >
    <!-- include the bootstap style sheet -->
    <link rel="stylesheet"  type="text/css"
          href="/bower_components/bootstrap-css/css/bootstrap.min.css">
    <!-- include the syntax highlight style sheet -->
    <link rel="stylesheet" type="text/css" media="all"
          href="/css/syntax.css" >
    <!-- include the customized style sheet -->
    <link rel="stylesheet" type="text/css" media="all"
          href="/css/customize.css">
    <!-- add the page specified style sheet settings -->

    

    <!-- jquery -->
    <script type="text/javascript"
            src="/bower_components/jqueryjs/jquery.js"></script>
    <!-- bootstrap -->
    <script type="text/javascript"
            src="/bower_components/bootstrap-css/js/bootstrap.min.js"></script>

    <!-- handle the DOM ready event, compatible with different browsers. -->
    <script type="text/javascript"
            src="/bower_components/domready/ready.min.js"></script>
    <!-- support the extended regular expression -->
    <script type="text/javascript"
            src="/bower_components/xregexp/min/xregexp-all-min.js"></script>
    <!-- fix the extra spaces between CJK characters introduced by the line
         break in the source -->
    <script type="text/javascript"
            src="/bower_components/fix-cjk-linebreak/fix-cjk-linebreak.js"></script>

    <!-- other customied scripts -->
    <script type="text/javascript"
            src="/js/customize.js"></script>

	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ['$', '$'] ],
			displayMath: [ ['$$', '$$']],
			processEscapes: true,
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		messageStyle: "none",
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
		});
	</script>
	<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

  </head>

  <body>
    

<div class="navbar">
  <div class="navbar-inner">
    <div class="container-narrow">
      <a class="brand" href="/">Ifeoma Veronica Nwabufo</a>
      <ul class="nav pull-right">
        
           
             





<li>
  <a href="/index.html">Home</a>
</li>

           
        
           
             





<li>
  <a href="/projects.html">Projects</a>
</li>

           
        
           
             





<li>
  <a href="/publications.html">Publications</a>
</li>

           
        
           
             





<li>
  <a href="/cv.html">Curriculum Vitae</a>
</li>

           
        
        


      </ul>
    </div>
  </div>
</div>

    <div class="container-narrow">
      <div class="content">
        <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<div class="page-header">
  <h1>TensorFlow APIs
      </h1>
</div>

<div class="post-info">
  
<link rel="stylesheet" href="/glyphicons/css/glyphicons.css">
<div class="category-info">
  <ul class="tag_box inline">
  
    <li><i class="icon-folder-open"></i></li>
    
    


  
     
    	<li><a href="/coding.html">
    		coding <sup></sup>
    	</a></li>
    
  


    
  
    <li><i class="icon-tags"></i></li>
    
    


  
     
    	<li><a href="/tags.html#tensorflow-ref">tensorflow <sup></sup></a></li>
    
  



    
  </ul>
</div>
  

<div class="source-info">
  <p>
  <span class="date"></span>
  &nbsp
  
  </p>
</div>

</div>
<div id="post-content" class="post-content">
   <ul id="markdown-toc">
  <li><a href="#tfnnsoftmax" id="markdown-toc-tfnnsoftmax"><code class="highlighter-rouge">tf.nn.softmax</code></a></li>
  <li><a href="#restore-pre-trained-models" id="markdown-toc-restore-pre-trained-models">Restore pre-trained models</a></li>
</ul>

<h3 id="tfnnsoftmax"><a href="https://www.tensorflow.org/versions/master/api_docs/python/tf/nn/softmax"><code class="highlighter-rouge">tf.nn.softmax</code></a></h3>
<p>在最后一个维度做softmax操作, 比如:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">C</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">C</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

<span class="n">aa</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">bb</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">ss</span><span class="p">:</span>
	<span class="n">bbval</span> <span class="o">=</span> <span class="n">ss</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="n">bbval</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">bbval</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># &lt;== will get all ones' result
</span></code></pre></div></div>

<h3 id="restore-pre-trained-models">Restore pre-trained models</h3>
<p>In TensorFlow, a <code class="highlighter-rouge">tf.train.Saver</code> is a module to save and restore variables to disk. If we need to specify which variables to restore, we need to pass a variable <code class="highlighter-rouge">dict</code> or <code class="highlighter-rouge">list</code> to <code class="highlighter-rouge">tf.train.Saver</code>. Using <code class="highlighter-rouge">list</code> is simple, now we just talk about how to use <code class="highlighter-rouge">dict</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">name_to_vars</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="c1"># key: the variable name saved in the checkpoint file, value: the TensorFlow variable we need to restore.
</span><span class="n">saver_for_restore</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">Saver</span><span class="p">(</span><span class="n">name_to_vars</span><span class="p">)</span>
</code></pre></div></div>

<p>Note that in <code class="highlighter-rouge">name_to_vars</code>, the <code class="highlighter-rouge">key</code> is a string, i.e. the variable name saved in the checkpoint file, not the name you defined in your graph. The <code class="highlighter-rouge">value</code> is the TensorFlow variable we need to restore, it is the variable you define in your current graph. See the following code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">save_ckpt</span><span class="p">():</span>
    <span class="n">FLAGS</span><span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">'train'</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">CENet3D</span><span class="p">(</span><span class="n">FLAGS</span><span class="p">)</span>

    <span class="n">name_to_vars</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">net</span><span class="p">.</span><span class="n">all_vars</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">'discriminator_im'</span> <span class="ow">in</span> <span class="n">var</span><span class="p">.</span><span class="n">op</span><span class="p">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">var</span><span class="p">.</span><span class="n">op</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'discriminator_im'</span><span class="p">,</span> <span class="s">'discriminator'</span><span class="p">)</span>
            <span class="n">name_to_vars</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span>
        <span class="k">if</span> <span class="s">'generator_vd'</span> <span class="ow">in</span> <span class="n">var</span><span class="p">.</span><span class="n">op</span><span class="p">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s">'discriminator_vd'</span> <span class="ow">in</span> <span class="n">var</span><span class="p">.</span><span class="n">op</span><span class="p">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">var</span><span class="p">.</span><span class="n">op</span><span class="p">.</span><span class="n">name</span>
            <span class="n">name_to_vars</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span>
    <span class="n">saver_only_for_restore</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">Saver</span><span class="p">(</span><span class="n">name_to_vars</span><span class="p">)</span>
    <span class="n">saver_for_save</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">Saver</span><span class="p">(</span><span class="n">net</span><span class="p">.</span><span class="n">all_vars</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">tfconfig</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
        <span class="n">init_op</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">(),</span> <span class="n">tf</span><span class="p">.</span><span class="n">local_variables_initializer</span><span class="p">())</span>
        <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">init_op</span><span class="p">)</span>
        <span class="n">ckpt</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">get_checkpoint_state</span><span class="p">(</span><span class="n">FLAGS</span><span class="p">.</span><span class="n">log_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ckpt</span> <span class="ow">and</span> <span class="n">ckpt</span><span class="p">.</span><span class="n">model_checkpoint_path</span><span class="p">:</span>
            <span class="n">saver_only_for_restore</span><span class="p">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">ckpt</span><span class="p">.</span><span class="n">model_checkpoint_path</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'model restored...'</span><span class="p">)</span>
            <span class="n">saver_for_save</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">'./'</span><span class="p">,</span> <span class="s">'initial_weights.ckpt'</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'no model found!'</span><span class="p">)</span>
</code></pre></div></div>


   

</div>
<script type="text/javascript">
  var el = document.getElementById("post-content");
  fix_cjk_linebreak(el);
  fix_table_style(el);
</script>
<div class="sharing align-right">
  <!--

  
    
        <div id="fb-root inline"></div>
<script>
(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-like inline" 
     data-href="/archive/trash/2017-07-11-tensorflow-apis.html" 
     
     data-layout="button_count" 
     
     
     data-width="90" 
     
     
     data-show-faces="false" 
     
     data-send="false">
</div>
      
  
    
        <div class="g-plusone inline"
      data-size="medium" 
      data-annotation="bubble" 
      
      data-width="20"
      
></div>

<script type="text/javascript">
(function() {
  var po = document.createElement('script'); 
  po.type = 'text/javascript';
  po.async = true;
  po.src = 'https://apis.google.com/js/plusone.js';
  var s = document.getElementsByTagName('script')[0]; 
  s.parentNode.insertBefore(po, s);
})();
</script>

      
  

-->
</div>
<div class="align-center">
  

<link rel="stylesheet" href="/glyphicons/css/glyphicons.css" />

<div class="pagination">
  <ul>
  
    <li class="prev disabled">
      <a> <em class="icon-left-arrow"></em> </a>
    </li>
  
    <li>
      <a href="/archive.html">&nbsp;&nbsp;<em class="icon-more-items"></em>&nbsp;&nbsp;</a>
    </li>
  
    <li class="next disabled">
      <a> <em class="icon-right-arrow"></em> </a>
    </li>
  
  </ul>
</div>
</div>
<hr/>


<a href="#" class="back-to-top">Back to Top</a>
<style>
a.back-to-top {
    display: none;
    width: 60px;
    height: 60px;
    text-indent: -9999px;
    position: fixed;
    z-index: 999;
    right: 20px;
    bottom: 20px;
    background: #eee url("images/angle-up.svg") no-repeat center 40%;
    background-size: 35px 35px;
    -webkit-border-radius: 30px;
    -moz-border-radius: 30px;
    border-radius: 30px;
}
</style>

<script type="text/javascript">
    $('body').prepend('<a href="#" class="back-to-top">Back to Top</a>');
    var amountScrolled = 10;
    var duration = 300;
    $(window).scroll(function() {
        if ( $(window).scrollTop() > amountScrolled ) {
            $('a.back-to-top').fadeIn('slow');
        } else {
            $('a.back-to-top').fadeOut('slow');
        }
    });

    jQuery('.back-to-top').click(function(event) {
      event.preventDefault();
      jQuery('html, body').animate({scrollTop: 0}, duration);
      return false;
    })
</script>

<script type="text/javascript">
function dashangToggle()
{
  $(".shang_box").fadeToggle();
}
function changeItem(i)
{
  var k = 3;
  for(var j = 0;j < k;j++)
  {
    if(j == i)
    {
      document.getElementById("sl_shang" + j).style.display = "block";
    }
    else
    {
      document.getElementById("sl_shang" + j).style.display = "none";
    }
  }
}
function opay()
{
  document.getElementById("sl_shang").target="_parent";
}
</script>

<style>
.sy_shang{
  clear:both;
  overflow:hidden;
}
.shang_box{
  width:200px;
  max-width:98%;
  height:300px;
  padding:10px;
  background-color:#ddd;
  border-radius:26px;
  position:inherit;
  z-index:1000;
  border:3px dotted #dedede;
  display:none;
}
.dashang{
  display:block;
  width:80px;
  margin:5px auto;
  height:17px;
  line-height:14px;
  padding:10px;
  background-color:#E74851;
  color:#fff !important;
  text-align:center;
  text-decoration:none;
  border-radius:10px;
  font-size:17px;
  font-style: italic;
  transition:all 0.3s;
}
.dashang:hover
{
  opacity:1.2;
  font-size:18px;
}
#sl_shang0,#sl_shang1,#sl_shang2
{
  text-align:center;
}
#sl_shang0 img,#sl_shang1 img,#sl_shang2 img
{
  max-width:180px;
}
.sl_shang
{
  overflow:hidden;
}
.sl_shang b { font-size:18px; }
.sl_shang ul{ margin-top:10px; clear:both; overflow:hidden; }
.sl_shang li{ float:left; }
</style>

<!-- <center>
<div class="sy_shang">
  <a href="javascript:void(0)" onclick="dashangToggle()" class="dashang" title="打赏，支持一下">
    <table>
      <col width="50%">
      <col width="50%">
      <tr>
        <td align="center" valign="top"><em class="icon-coins"></em></td>
        <td align="right" valign="top">Donate</td>
      </tr>
    </table>
  </a>

<div class="shang_box">
  <a href="javascript:void(0)" onclick="dashangToggle()" title="关闭" style="float:right;"><em class="icon-remove-2"></em></a>

<div id="sl_shang" onsubmit="return postcheck()">
  <div class="sl_shang">
    <i>How to Donate:</i>
    <table width="80%">
      <col width="50%">
      <col width="50%">
    <tr>
      <td align="center" valign="middle"><input type="radio" name="paytype" onclick="opay();return changeItem(0);" checked="checked"/>
        </td>
      <td align="center" valign="bottom"><input type="radio" name="paytype" onclick="opay();return changeItem(1);" />
        </td>
      </tr>
    <tr>
      <td align="center" valign="middle"> Alipay </td>
      <td align="center" valign="middle"> WeChat </td>
    </tr>
    </table>
  </div>

<div id="sl_shang0">
  <img src="images/alipay.jpg">
  <br> Open Alipay and Scan
</div>

<div id="sl_shang1" style="display:none;">
  <img src="images/wechat.jpg">
  <br> Open WeChat and Scan
</div>

</center> -->

      </div>
      <hr/>
      <!--

<div style='text-align:center;'>
  <p>&copy; 2022 Ifeoma Veronica Nwabufo
    with help from <a href="http://jekyllbootstrap.com"
                      target="_blank"
                      title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
    and <a href="http://twitter.github.com/bootstrap/"
           target="_blank">Twitter Bootstrap</a>
    <br/>
    <a rel="license" class="cc-logo" target="_blank" href="">
      
    </a>
    This work is licensed under a
    <a rel="license" target="_blank" href="">
      Creative Commons License
    </a>
  </p>
</div>
-->
    </div>
    
  <div style="display:none;">
  <script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=100&d=t7DslErsFCxmkrmJJEHTOzpoZGpkDt1-vHFIeXzC0gc&t=n'></script>
  </div>
  </body>
</html>



